    <?xml version="1.0" encoding="UTF-8"?>
    <api context="/order" name="order" xmlns="http://ws.apache.org/ns/synapse">
        <resource methods="GET" uri-template="/{productId}">
            <inSequence>
                <!-- extract product id from request path -->
                <property name="productId" expression="get-property('uri.var.productId')" scope="default"/>
                
                <!-- call inventory api dynamically -->
                <call blocking="true">
                    <endpoint>
                        <http method="get">
                             <uri-template>
                                "http://127.0.0.1:8000/inventory/{uri.var.productId}"
                            </uri-template>
                        </http>
                    </endpoint>
                </call>

                <!-- extract stock value from responce JSON -->
                <property name="stock" expression="json-eval($.stock)" type="INTEGER" scope="default"/>

                <!-- extract stock value from responce JSON -->
                <filter xpath="get-property('stock') > 0">
                    <then>
                        <!-- Place order -->
                        <payloadFactory media-type="json">
                            <format>{"status":"order place successfully!"}</format>
                        </payloadFactory>
                        <respond/>
                    </then>
                    <else>
                        <!-- Out of stock -->
                        <payloadFactory media-type="json">
                            <format>{"status":"out of stock!"}</format>
                        </payloadFactory>
                        <respond/>
                    </else>
                </filter>
            </inSequence>
            <faultSequence>
            </faultSequence>
        </resource>
    </api>